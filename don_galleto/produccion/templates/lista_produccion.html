{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mt-4">
    <h1 class="text-center mb-4"><i class="bi bi-gear-wide-connected"></i> Producci√≥n de Galletas</h1>

    <div class="row row-cols-1 row-cols-md-3 g-4">
        {% for item in lista %}
        <div class="col">
            <div class="card border rounded-4 p-3">
                <div class="card-body">
                    <h5 class="card-title text-primary">Lote {{ item.id_lote_galleta }}</h5>
                    <p class="text-muted mb-1"><i class="bi bi-cookie"></i> Galleta: <strong>{{ item.id_galleta.nombre }}</strong></p>
                    <p class="mb-1"><i class="bi bi-box-seam"></i> Cantidad: <strong>{{ item.cantidad_galletas }}</strong></p>
                    <p class="mb-1"><i class="bi bi-calendar-check"></i> Fecha: <strong>{{ item.fecha_preparacion }}</strong></p>

                    <p class="mb-3">
                        <span class="badge {% if item.estatus == 'Pendiente' %}bg-secondary
                        {% elif item.estatus == 'Mezclando' %}bg-primary
                        {% elif item.estatus == 'Formando' %}bg-info text-dark
                        {% elif item.estatus == 'Horneando' %}bg-warning text-dark
                        {% elif item.estatus == 'Enfriando' %}bg-success
                        {% elif item.estatus == 'Completado' %}bg-dark
                        {% else %}bg-danger{% endif %}">
                            
                        <i class="bi {% if item.estatus == 'Pendiente' %}bi-hourglass-split
                        {% elif item.estatus == 'Mezclando' %}bi-arrow-repeat
                        {% elif item.estatus == 'Formando' %}bi-hand-index-thumb
                        {% elif item.estatus == 'Horneando' %}bi-fire
                        {% elif item.estatus == 'Enfriando' %}bi-snow
                        {% elif item.estatus == 'Completado' %}bi-check-circle
                        {% else %}bi-x-circle{% endif %}"></i> {{ item.estatus }}
                        </span>
                    </p>

                    <form method="post" action="{% url 'actualizar_estatus_lote' item.id_lote_galleta %}">
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="estatus">Cambiar Estatus:</label>
                            <select name="estatus" class="form-control" id="estatus">
                                <option value="Pendiente" {% if item.estatus == 'Pendiente' %}selected{% endif %}>Pendiente</option>
                                <option value="Mezclando" {% if item.estatus == 'Mezclando' %}selected{% endif %}>Mezclando</option>
                                <option value="Formando" {% if item.estatus == 'Formando' %}selected{% endif %}>Formando</option>
                                <option value="Horneando" {% if item.estatus == 'Horneando' %}selected{% endif %}>Horneando</option>
                                <option value="Enfriando" {% if item.estatus == 'Enfriando' %}selected{% endif %}>Enfriando</option>
                                <option value="Completado" {% if item.estatus == 'Completado' %}selected{% endif %}>Completado</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-outline-primary mt-2 w-100">
                            <i class="bi bi-check-lg"></i> Guardar Estatus
                        </button>
                    </form>

                    <a href="{% url 'agregar_merma' item.id_lote_galleta %}" class="btn btn-outline-danger mt-2 w-100">
                        <i class="bi bi-x-circle"></i> Agregar Merma
                    </a>
                    
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12 text-center text-muted">
            <p>No hay lotes pendientes.</p>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock content %}
